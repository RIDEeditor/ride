<html>
    <head>
        <title>RIDE Editor</title>
        <script>window.$ = window.jQuery = require("jquery");</script>
        <script>require("./js/jquery-ui/jquery-ui.js");</script>
        <script src="js/jstree.js"></script>
        <script src="js/underscore.js"></script>
        <script src="js/tabs.js"></script>
        <script src="ace-builds/src/ace.js"></script>
        <script src="ace-builds/src/ext-themelist.js"></script>
        <script src="ace-builds/src/ext-modelist.js"></script>
        <script src="ace-builds/src/ext-statusbar.js"></script>
        <link rel="stylesheet" type="text/css" href="css/tabs.css">
        <link rel="stylesheet" type="text/css" href="css/jstree.css">
        <link rel="stylesheet" type="text/css" href="bootstrap-icon/css/bootstrap.css">
    </head>
    <body>


        <div class="panel-container">

            <div class="panel-left">
                <div id="treecontainer">
                    <div id="treeview"></div>
                </div>
            </div>

            <div class="splitter">
            </div>

            <div class="panel-right">
                <div class="panel-right-top">
                    <div class="tabs-shell tabs">
                        <div class="tabs">
                            <button class='new'>+</button>
                        </div>
                    </div>

                    <div id="code"></div>
                </div>
                <div class="panel-right-bottom">
                    <div id="console"></div>
                </div>
            </div>
        </div>


        <footer>
            <div id="statusBar"></div>
        </footer>
        
    </body>

<script>
    var TabsList = {}; // Holds all tabs that have been created
    var tab_bar; // Represents the top tab bar
    var editor;
    $(document).ready(function() {
        $('#treeview').jstree({ 'core' : {
            "check_callback" : true
        } });

        $('#treeview').on("select_node.jstree", function (e, data) {
            for(i = 0, j = data.selected.length; i < j; i++) {
                var node = data.instance.get_node(data.selected[i]);
                if (node.original.type == "file") {
                    var path = node.data;
                    handleNewClicked();
                    current_editor.readFileIntoEditor(path);
                }
            }
        });

        $("#treeview").on('hover_node.jstree',function(e,data){
            $("#"+data.node.id).prop('title', data.node.original.full_path);
        });

        $(function () {
          $("#plugins7").jstree({
            "types" : {
              "default" : {
                "icon" : "glyphicon glyphicon-flash"
              },
              "demo" : {
                "icon" : "glyphicon glyphicon-ok"
              }
            },
            "plugins" : [ "types" ]
          });
        });

        // Setup the tabs bar
        tab_bar = new Tabs({
            shell: $('.tabs-shell'),
            minWidth: 45,
            maxWidth: 180
        });

        editor = ace.edit('code');
        editor.setValue("");
        editor.setTheme("ace/theme/monokai");

        // Define what the 'new tab' button does
        $('.new').on('click', function(ev) {
            new Tab();
        });

        new Tab("untitled");

        var StatusBar = ace.require("ace/ext/statusbar").StatusBar;
        // Create a simple selection status indicator
        var statusBar = new StatusBar(editor, document.getElementById("statusBar"));


        // Set panel as resizable
        $(".panel-left").resizable({
            handles: 'e',
            resizeHeight: false,
        });


    });

    // Load ace extras
    var AceDocument = ace.require("ace/document");
    var EditSession = ace.require("ace/edit_session");
    var UndoManager = ace.require("ace/undomanager");

    /**
    * Switches focus to the tab with the given id
    */
    var switchTab = function(id) {
        var doc = TabsList[id];
        editor.setSession(doc.aceSession);
        editor.focus();
        current_editor = doc;
    }


</script>

<!-- setup the menus -->
<script src="js/menu.js"></script>
<script src="js/editor.js"></script>

<style>
    html,body {
        background-color: #161712;
        height: 100%;
        padding: 0;
        margin: 0;
        overflow: auto;
    }

    footer{
        float: bottom;
        height: 2%;
    }

    .tabs-shell {
        width: 100%;
    }


    #code {
        height: calc(100% - 25px);
        width: 100%;
    }

    #statusBar {
        background-color: #323232;
        position: fixed;
        bottom: 0;
        height: 20px;
        width: 100%;
    }

    .ace_status-indicator{
        float: right;
        padding-right: 50px;
        color: white;
    }

    #treecontainer {
        height: 100%;
        overflow: auto;
    }

    button.new {
      padding: 5px;
      margin-left: 15px;
      background: transparent;
      color: #e1e3e1;
      border: none;
      font-size: 18px;
      font-weight: bold;
    }


    /* horizontal panel*/

    .panel-container {
        display: flex;
        flex-direction: row;
        overflow: hidden;
        height: calc(100% - 20px);
        /* avoid browser level touch actions */
        xtouch-action: none;
    }

    .ui-resizable-e {
        width: 19px;
        right: -19px;
        z-index: 101 !important;
    }

    .panel-left {
        flex: 0 0 auto;
        /* only manually resize */
        padding: 0px;
        width: 350px;
        min-height: 200px;
        min-width: 0px;
        max-width: 400px;
        white-space: nowrap;
        color: white;
    }

    .splitter {
        flex: 0 0 auto;
        width: 18px;  
        background: url(https://raw.githubusercontent.com/RickStrahl/jquery-resizable/master/assets/vsizegrip.png) center center no-repeat #535353;
        min-height: 200px;
        z-index: 100;
    }

    .panel-right {
        flex: 1 1 auto;
        /* resizable */
        padding: 0px;
        width: 100%;
        min-height: 200px;
        min-width: 200px;
    }

</style>

